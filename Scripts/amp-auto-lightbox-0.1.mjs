;
(self.AMP=self.AMP||[]).push({m:1,v:"2210010655000",n:"amp-auto-lightbox",ev:"0.1",l:!0,f:function(t,n){(()=>{var n="load-end";function r(t){return t?Array.prototype.slice.call(t):[]}var{hasOwnProperty:e,toString:o}=Object.prototype;function i(t,n,r,e,o,i,u,l,a,c,s){return t}function u(t){return(t.ownerDocument||t).defaultView}function l(t,n){return t.closest(n)}var a,c,s,f={bubbles:!0,cancelable:!0},d=class{constructor(){this.promise=new Promise(((t,n)=>{this.resolve=t,this.reject=n}))}};new WeakMap,new WeakMap,self.__AMP_LOG=self.__AMP_LOG||{user:null,dev:null,userForEmbed:null};var p=self.__AMP_LOG;function h(t){return function(t,n){throw new Error("failed to call initLogConstructor")}()}function g(t,n,r,e,o,i,u,l,a,c,s){return t}function m(t,n){return y(t=function(t){return t.__AMP_TOP||(t.__AMP_TOP=t)}(t),n)}function v(t,n){return y(w(b(t)),n)}function b(t){return t.nodeType?(n=u(t),m(n,"ampdoc")).getAmpDoc(t):t;var n}function w(t){const n=b(t);return n.isSingleDoc()?n.win:n}function y(t,n){g(P(t,n));const r=function(t){let n=t.__AMP_SERVICES;return n||(n=t.__AMP_SERVICES={}),n}(t)[n];return r.obj||(g(r.ctor),g(r.context),r.obj=new r.ctor(r.context),g(r.obj),r.context=null,r.resolve&&r.resolve(r.obj)),r.obj}function P(t,n){const r=t.__AMP_SERVICES&&t.__AMP_SERVICES[n];return!(!r||!r.ctor)}var x,M=t=>v(t,"mutator");function A(t,n,r,e){let o=r;const i=function(t,n,r,e){let o=t,i=r,u=t=>{try{return i(t)}catch(t){var n,r;throw null===(n=(r=self).__AMP_REPORT_ERROR)||void 0===n||n.call(r,t),t}};const l=function(){if(void 0!==x)return x;x=!1;try{const t={get capture(){return x=!0,!1}};self.addEventListener("test-options",null,t),self.removeEventListener("test-options",null,t)}catch(t){}return x}(),a=!(null==e||!e.capture);return o.addEventListener(n,u,l?e:a),()=>{null==o||o.removeEventListener(n,u,l?e:a),i=null,o=null,u=null}}(t,n,(t=>{try{o(t)}finally{o=null,i()}}),e);return i}function O(t){return"AUDIO"===t.tagName||"VIDEO"===t.tagName}/nochunking=1/.test(self.location.hash),a||(a=Promise.resolve(void 0));var C="i-amphtml-auto-lightbox-visited",I={"Article":!0,"NewsArticle":!0,"BlogPosting":!0,"LiveBlogPosting":!0,"DiscussionForumPosting":!0},S=["[placeholder]","[data-amp-auto-lightbox-disable]","amp-selector [option]","[subscriptions-action]"].join(","),W=["a[href]","amp-script","amp-story","button","amp-lightbox","amp-carousel"].join(","),D=()=>{},T=class{static meetsAll(t,n,r,e){return T.meetsSizingCriteria(t,n,r,e)&&T.meetsTreeShapeCriteria(t,n)}static meetsTreeShapeCriteria(t,n){return!("IMG"===t.tagName&&l(t,"amp-img")||l(t,`${W},${S}`)||(t=>function(t,n){const r=w(b(t));return P(r,n)?y(r,n):null}(t,"action"))(n||t).hasResolvableAction(t,"tap"))}static meetsSizingCriteria(t,n,r,e){const{naturalHeight:o,naturalWidth:i}=function(t){const{naturalHeight:n,naturalWidth:r}=t,e=r/n,o=function(t){let n=-1;const r=t.getAttribute("srcset");if(r){let t;for(;t=B.exec(r);){const r=parseInt(t[1],10);r>n&&(n=r)}}return n}(t);return o>r?{naturalWidth:o,naturalHeight:o/e}:{naturalWidth:r,naturalHeight:n}}(t.querySelector("img")||t),u=v(n,"viewport"),{height:l,width:a}=u.getSize();return function(t,n,r,e,o,i){const u=t*n;return r*e/u>=1.2||r>o||e>i||u/(o*i)>=.25}(r,e,i,o,a,l)}},B=/\s+([0-9]+)w(,|[\S\s]*$)/g;function E(t){return M(t).mutateElement(t,(()=>{t.setAttribute(C,"")}))}var $=class{static getOgType(t){const n=t.getRootNode().querySelector('meta[property="og:type"]');if(n)return n.getAttribute("content")}static hasValidOgType(t){return"article"==$.getOgType(t)}static getAllLdJsonTypes(t){return r(t.getRootNode().querySelectorAll('script[type="application/ld+json"]')).map((t=>{const{textContent:n}=t;return(function(t,n){try{return function(t){return JSON.parse(t)}(t)}catch(t){return null}}(n)||{})["@type"]})).filter(Boolean)}static hasValidLdJsonType(t){return $.getAllLdJsonTypes(t).some((t=>I[t]))}},k=0;function G(t,e){if(!function(t){return!function(t){const n=`[lightbox]:not([${C}])`,r=n=>!!t.getRootNode().querySelector(n);return r('script[custom-element="amp-lightbox-gallery"]')&&r(n)}(t)&&($.hasValidOgType(t)||$.hasValidLdJsonType(t))}(t))return;const o=e||t.win.document;return function(t,r){return r.map((r=>{return(e=r,"IMG"===e.tagName?function(t){let n,r;if(function(t){return!!(t.complete||"complete"==t.readyState||O(t)&&t.readyState>0||t.document&&"complete"==t.document.readyState)}(t))return Promise.resolve(t);const e=O(t);return e&&t.__AMP_MEDIA_LOAD_FAILURE_SRC===t.currentSrc?Promise.reject(t):new Promise(((o,i)=>{if(n=e?A(t,"loadedmetadata",o,{capture:!0}):A(t,"load",o),!t.tagName)return;let u=t;if(e&&!t.hasAttribute("src")&&(u=function(t,n){for(let r=t.lastElementChild;r;r=r.previousElementSibling)if(n(r))return r;return null}(t,(t=>"SOURCE"===t.tagName)),!u))return i(new Error("Media has no source."));r=A(u,"error",i)})).then((()=>(r&&r(),t)),(()=>{n&&n(),function(t){O(t)&&(t.__AMP_MEDIA_LOAD_FAILURE_SRC=t.currentSrc||!0);let n=t;throw n&&n.src&&(n=n.src),(p.user||(p.user=h()),void p.user.win?p.userForEmbed||(p.userForEmbed=h()):p.user).createError("Failed to load:",n)}(t)}))}(e):function(t){if(i(function(t){const n=t.tagName;return n.startsWith("AMP-")&&!("AMP-STICKY-AD-TOP-PADDING"==n||"AMP-BODY"==n)}(t)),t.createdCallback)return Promise.resolve(t);if(!t.__AMP_UPG_PRM){const n=new d;t.__AMP_UPG_PRM=n.promise,t.__AMP_UPG_RES=n.resolve}const n=t.__AMP_UPG_PRM;return i(n),n}(e).then((t=>t.signals().whenSignal(n)))).then((()=>function(t){var n;let r=null===(n=c)||void 0===n?void 0:n.get(t);if(!r){const n=function(t){c||(c=new WeakMap,s=new WeakMap),i(s);let n=s.get(t);return n||(n=function(t,n,r={}){const{needsRootBounds:e,rootMargin:o,threshold:i}=r,u=function(t){return t.parent&&t.parent!=t}(n)&&(e||o)?n.document:void 0;return new n.IntersectionObserver(t,{threshold:i,root:u,rootMargin:o})}((t=>{const r=new Set;for(let o=t.length-1;o>=0;o--){var e;const{target:u}=t[o];r.has(u)||(r.add(u),i(n),n.unobserve(u),i(c),null===(e=c.get(u))||void 0===e||e.resolve(t[o]),c.delete(u))}}),t,{needsRootBounds:!1}),s.set(t,n)),n}(u(t));i(c),n.observe(t),r=new d,c.set(t,r)}return r.promise}(r).then((({boundingClientRect:e})=>{if("IMG"!==r.tagName&&!r.signals().get(n))return;const{height:o,width:u}=e;return T.meetsAll(r,t,u,o)?function(t,n){return M(t).mutateElement(n,(()=>{n.setAttribute("lightbox","i-amphtml-auto-lightbox-"+k++)})).then((()=>{return(r=t.win,m(r,"extensions")).installExtensionForDoc(t,"amp-lightbox-gallery"),function(t,n,r,e){i(t.ownerDocument);const o=t.ownerDocument.createEvent("Event");o.data={};const{bubbles:u,cancelable:l}=f;o.initEvent("amp-auto-lightbox:newly-set",u,l),t.dispatchEvent(o)}(n),n;var r}))}(t,r):void 0}))),D);var e}))}(t,class{static getCandidates(t){const n=["amp-img","img"].map((t=>`${t}:not([lightbox]):not([${C}])`)).join(","),e=r(t.querySelectorAll(n));return e.forEach(E),e}}.getCandidates(o))}var{ampdoc:H}=t;H.whenReady().then((()=>{H.getRootNode().addEventListener("amp:dom-update",(t=>{const{target:n}=t;G(H,n)})),G(H)}))})();
/*! https://mths.be/cssescape v1.5.1 by @mathias | MIT license */}});
//# sourceMappingURL=amp-auto-lightbox-0.1.mjs.map